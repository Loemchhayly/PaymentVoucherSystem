{% extends 'base.html' %}
{% load static %}

{% block title %}All Signature Batches{% endblock %}

{% block content %}
<div class="container-fluid" style="max-width: 1400px; margin-top: -2rem;">
    <!-- Page Header -->
    <div class="page-header" style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1 style="font-size: 1.5rem; font-weight: 700; color: #1f2937; margin: 0;">
                <i class="bi bi-folder2-open" style="color: #667eea; font-size: 1.75rem;"></i>
                All Signature Batches
            </h1>
            <p style="color: #6b7280; margin-top: 0.25rem; font-size: 0.9rem;">View all signature batches in the system</p>
        </div>
        <div>
            <a href="{% url 'dashboard:home' %}" class="btn btn-secondary btn-sm">
                <i class="bi bi-arrow-left"></i> Back
            </a>
        </div>
    </div>

    <!-- Stats Summary -->
    <div class="row mb-3">
        <div class="col-md-3">
            <div class="card" style="border-left: 4px solid #667eea;">
                <div class="card-body" style="padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <small style="color: #6b7280; text-transform: uppercase; font-weight: 600;">Total</small>
                            <h3 style="margin: 0.25rem 0 0 0; color: #667eea;">{{ total_count }}</h3>
                        </div>
                        <i class="bi bi-folder" style="font-size: 2rem; color: #667eea; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card" style="border-left: 4px solid #f59e0b;">
                <div class="card-body" style="padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <small style="color: #6b7280; text-transform: uppercase; font-weight: 600;">Pending</small>
                            <h3 style="margin: 0.25rem 0 0 0; color: #f59e0b;">{{ pending_count }}</h3>
                        </div>
                        <i class="bi bi-hourglass-split" style="font-size: 2rem; color: #f59e0b; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card" style="border-left: 4px solid #10b981;">
                <div class="card-body" style="padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <small style="color: #6b7280; text-transform: uppercase; font-weight: 600;">Signed</small>
                            <h3 style="margin: 0.25rem 0 0 0; color: #10b981;">{{ signed_count }}</h3>
                        </div>
                        <i class="bi bi-check-circle" style="font-size: 2rem; color: #10b981; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card" style="border-left: 4px solid #ef4444;">
                <div class="card-body" style="padding: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <small style="color: #6b7280; text-transform: uppercase; font-weight: 600;">Rejected</small>
                            <h3 style="margin: 0.25rem 0 0 0; color: #ef4444;">{{ rejected_count }}</h3>
                        </div>
                        <i class="bi bi-x-circle" style="font-size: 2rem; color: #ef4444; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pending Batches -->
    {% if pending_batches %}
    <div class="card mb-3">
        <div class="card-header" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; border: none;">
            <h5 style="margin: 0;">
                <i class="bi bi-hourglass-split"></i>
                Pending MD Signature ({{ pending_count }})
            </h5>
        </div>
        <div class="card-body" style="padding: 0;">
            <div class="table-responsive">
                <table class="table table-hover" style="margin: 0;">
                    <thead style="background: #f9fafb;">
                        <tr>
                            <th>Batch Number</th>
                            <th>Created By</th>
                            <th>Created At</th>
                            <th>Documents</th>
                            <th>Total Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for batch in pending_batches %}
                        <tr>
                            <td>
                                <strong style="color: #667eea;">{{ batch.batch_number }}</strong>
                            </td>
                            <td>
                                {% if batch.created_by.get_full_name %}
                                    {{ batch.created_by.get_full_name }}
                                {% else %}
                                    {{ batch.created_by.username }}
                                {% endif %}
                            </td>
                            <td>{{ batch.created_at|date:"M d, Y H:i" }}</td>
                            <td>
                                <span class="badge bg-primary">{{ batch.get_document_count }}</span>
                            </td>
                            <td>
                                <strong style="color: #10b981;">{{ batch.get_total_amount_display }}</strong>
                            </td>
                            <td>
                                <a href="{% url 'vouchers:batch_detail' batch.id %}" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-eye"></i> View
                                </a>
                                <a href="{% url 'vouchers:batch_export_excel' batch.id %}" class="btn btn-sm btn-outline-success">
                                    <i class="bi bi-file-earmark-excel"></i> Excel
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Signed Batches -->
    {% if signed_batches %}
    <div class="card mb-3">
        <div class="card-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none;">
            <h5 style="margin: 0;">
                <i class="bi bi-check-circle"></i>
                Signed Batches ({{ signed_count }})
            </h5>
        </div>
        <div class="card-body" style="padding: 0;">
            <div class="table-responsive">
                <table class="table table-hover" style="margin: 0;">
                    <thead style="background: #f9fafb;">
                        <tr>
                            <th>Batch Number</th>
                            <th>Created By</th>
                            <th>Signed By</th>
                            <th>Signed At</th>
                            <th>Documents</th>
                            <th>Total Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for batch in signed_batches %}
                        <tr>
                            <td>
                                <strong style="color: #667eea;">{{ batch.batch_number }}</strong>
                            </td>
                            <td>
                                {% if batch.created_by.get_full_name %}
                                    {{ batch.created_by.get_full_name }}
                                {% else %}
                                    {{ batch.created_by.username }}
                                {% endif %}
                            </td>
                            <td>
                                {% if batch.signed_by.get_full_name %}
                                    {{ batch.signed_by.get_full_name }}
                                {% else %}
                                    {{ batch.signed_by.username }}
                                {% endif %}
                            </td>
                            <td>{{ batch.signed_at|date:"M d, Y H:i" }}</td>
                            <td>
                                <span class="badge bg-primary">{{ batch.get_document_count }}</span>
                            </td>
                            <td>
                                <strong style="color: #10b981;">{{ batch.get_total_amount_display }}</strong>
                            </td>
                            <td>
                                <a href="{% url 'vouchers:batch_detail' batch.id %}" class="btn btn-sm btn-outline-success">
                                    <i class="bi bi-eye"></i> View
                                </a>
                                <a href="{% url 'vouchers:batch_export_excel' batch.id %}" class="btn btn-sm btn-success">
                                    <i class="bi bi-file-earmark-excel"></i> Excel
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Rejected Batches -->
    {% if rejected_batches %}
    <div class="card mb-3">
        <div class="card-header" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none;">
            <h5 style="margin: 0;">
                <i class="bi bi-x-circle"></i>
                Rejected Batches ({{ rejected_count }})
            </h5>
        </div>
        <div class="card-body" style="padding: 0;">
            <div class="table-responsive">
                <table class="table table-hover" style="margin: 0;">
                    <thead style="background: #f9fafb;">
                        <tr>
                            <th>Batch Number</th>
                            <th>Created By</th>
                            <th>Rejected By</th>
                            <th>Rejected At</th>
                            <th>Documents</th>
                            <th>Total Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for batch in rejected_batches %}
                        <tr>
                            <td>
                                <strong style="color: #667eea;">{{ batch.batch_number }}</strong>
                            </td>
                            <td>
                                {% if batch.created_by.get_full_name %}
                                    {{ batch.created_by.get_full_name }}
                                {% else %}
                                    {{ batch.created_by.username }}
                                {% endif %}
                            </td>
                            <td>
                                {% if batch.signed_by %}
                                    {% if batch.signed_by.get_full_name %}
                                        {{ batch.signed_by.get_full_name }}
                                    {% else %}
                                        {{ batch.signed_by.username }}
                                    {% endif %}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                {% if batch.signed_at %}
                                    {{ batch.signed_at|date:"M d, Y H:i" }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge bg-primary">{{ batch.get_document_count }}</span>
                            </td>
                            <td>
                                <strong style="color: #10b981;">{{ batch.get_total_amount_display }}</strong>
                            </td>
                            <td>
                                <a href="{% url 'vouchers:batch_detail' batch.id %}" class="btn btn-sm btn-outline-danger">
                                    <i class="bi bi-eye"></i> View
                                </a>
                                <a href="{% url 'vouchers:batch_export_excel' batch.id %}" class="btn btn-sm btn-outline-success">
                                    <i class="bi bi-file-earmark-excel"></i> Excel
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    {% if not pending_batches and not signed_batches and not rejected_batches %}
    <div class="card">
        <div class="card-body" style="text-align: center; padding: 3rem; color: #6b7280;">
            <i class="bi bi-inbox" style="font-size: 4rem; opacity: 0.3;"></i>
            <p style="margin-top: 1rem; font-size: 1.1rem;">No signature batches yet</p>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
